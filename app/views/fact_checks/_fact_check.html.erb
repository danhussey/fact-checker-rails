<%= turbo_frame_tag dom_id(fact_check), class: "block mb-4" do %>
  <article class="glass-card rounded-lg p-3 animate-card-enter">
    <div class="flex justify-between items-start gap-3">
      <%# Claim text %>
      <p class="font-display text-primary text-sm font-medium flex-1 leading-snug">
        "<%= fact_check.claim %>"
      </p>

      <%# Status badge %>
      <% if fact_check.completed? %>
        <%= render "fact_checks/verdict_badge", fact_check: fact_check %>
      <% elsif fact_check.processing? %>
        <span class="px-2.5 py-0.5 rounded-full bg-surface text-tertiary text-xs border border-border-subtle animate-pulse">
          Checking...
        </span>
      <% elsif fact_check.failed? %>
        <span class="px-2.5 py-0.5 rounded-full bg-red-500/10 text-red-400 text-xs border border-red-500/30">
          Error
        </span>
      <% else %>
        <span class="px-2.5 py-0.5 rounded-full bg-surface text-muted text-xs border border-border-subtle">
          Pending
        </span>
      <% end %>
    </div>

    <% if fact_check.completed? %>
      <details class="mt-2.5 group">
        <summary class="flex items-center gap-1.5 text-tertiary text-xs cursor-pointer hover:text-secondary transition-colors">
          <svg class="w-3.5 h-3.5 chevron-icon transition-transform duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
          </svg>
          <span>Details</span>
          <% if fact_check.whats_true&.any? %><span class="text-green-400"><%= fact_check.whats_true.size %> true</span><% end %>
          <% if fact_check.whats_wrong&.any? %><span class="text-red-400"><%= fact_check.whats_wrong.size %> false</span><% end %>
          <% if fact_check.context_points&.any? %><span class="text-blue-400"><%= fact_check.context_points.size %> context</span><% end %>
        </summary>

        <div class="mt-3 space-y-2.5">
          <% if fact_check.whats_true&.any? %>
            <div class="accent-border-green pl-2.5 py-1.5">
              <h4 class="font-mono text-[10px] text-green-400 uppercase tracking-wider mb-1.5">What's True</h4>
              <ul class="text-secondary text-xs space-y-1">
                <% fact_check.whats_true.each do |item| %>
                  <li><%= item.sub(/^[-•]\s*/, '') %></li>
                <% end %>
              </ul>
            </div>
          <% end %>

          <% if fact_check.whats_wrong&.any? %>
            <div class="accent-border-red pl-2.5 py-1.5">
              <h4 class="font-mono text-[10px] text-red-400 uppercase tracking-wider mb-1.5">What's Wrong</h4>
              <ul class="text-secondary text-xs space-y-1">
                <% fact_check.whats_wrong.each do |item| %>
                  <li><%= item.sub(/^[-•]\s*/, '') %></li>
                <% end %>
              </ul>
            </div>
          <% end %>

          <% if fact_check.context_points&.any? %>
            <div class="accent-border-blue pl-2.5 py-1.5">
              <h4 class="font-mono text-[10px] text-blue-400 uppercase tracking-wider mb-1.5">Context</h4>
              <ul class="text-secondary text-xs space-y-1">
                <% fact_check.context_points.each do |item| %>
                  <li><%= item.sub(/^[-•*]\s*/, '') %></li>
                <% end %>
              </ul>
            </div>
          <% end %>

          <% if fact_check.sources&.any? %>
            <div class="pt-1">
              <h4 class="font-mono text-[10px] text-muted uppercase tracking-wider mb-1.5">Sources</h4>
              <div class="flex flex-wrap gap-1.5">
                <% fact_check.sources.each do |source| %>
                  <% if source["url"].present? %>
                    <%= link_to source["name"], source["url"],
                        target: "_blank",
                        rel: "noopener",
                        class: "px-2 py-0.5 bg-surface text-tertiary text-[10px] rounded border border-border-subtle hover:border-border-medium hover:text-secondary transition-colors" %>
                  <% else %>
                    <span class="px-2 py-0.5 bg-surface text-muted text-[10px] rounded border border-border-subtle">
                      <%= source["name"] %>
                    </span>
                  <% end %>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      </details>
    <% end %>

    <p class="font-mono text-muted text-[10px] mt-2"><%= time_ago_in_words(fact_check.created_at) %> ago</p>
  </article>
<% end %>
