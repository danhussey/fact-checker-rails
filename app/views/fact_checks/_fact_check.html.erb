<%= turbo_frame_tag dom_id(fact_check), class: "block mb-4" do %>
  <article class="glass-card rounded-lg p-3 animate-card-enter">
    <div class="flex justify-between items-start gap-3">
      <p class="text-primary text-sm flex-1 leading-snug"><%= fact_check.claim %></p>

      <% if fact_check.completed? %>
        <%= render "fact_checks/verdict_badge", fact_check: fact_check %>
      <% elsif fact_check.processing? %>
        <span class="px-2.5 py-0.5 rounded-full bg-surface text-tertiary text-xs border border-border-subtle animate-pulse">Checking...</span>
      <% elsif fact_check.failed? %>
        <span class="px-2.5 py-0.5 rounded-full bg-red-500/10 text-red-400 text-xs border border-red-500/30">Error</span>
      <% else %>
        <span class="px-2.5 py-0.5 rounded-full bg-surface text-muted text-xs border border-border-subtle">Pending</span>
      <% end %>
    </div>

    <% if fact_check.completed? %>
      <details class="mt-2">
        <summary class="text-tertiary text-xs cursor-pointer hover:text-secondary transition-colors inline-flex items-center gap-1">
          <svg class="w-3 h-3 chevron-icon transition-transform duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
          </svg>
          More
        </summary>

        <div class="mt-2.5 space-y-2">
          <% if fact_check.whats_true&.any? %>
            <div class="accent-border-green pl-2.5 py-1">
              <ul class="text-secondary text-xs space-y-0.5">
                <% fact_check.whats_true.each do |item| %>
                  <li><%= item.sub(/^[-•]\s*/, '') %></li>
                <% end %>
              </ul>
            </div>
          <% end %>

          <% if fact_check.whats_wrong&.any? %>
            <div class="accent-border-red pl-2.5 py-1">
              <ul class="text-secondary text-xs space-y-0.5">
                <% fact_check.whats_wrong.each do |item| %>
                  <li><%= item.sub(/^[-•]\s*/, '') %></li>
                <% end %>
              </ul>
            </div>
          <% end %>

          <% if fact_check.context_points&.any? %>
            <div class="accent-border-blue pl-2.5 py-1">
              <ul class="text-secondary text-xs space-y-0.5">
                <% fact_check.context_points.each do |item| %>
                  <li><%= item.sub(/^[-•*]\s*/, '') %></li>
                <% end %>
              </ul>
            </div>
          <% end %>

          <% if fact_check.sources&.any? %>
            <div class="flex flex-wrap gap-1.5 pt-1">
              <% fact_check.sources.each do |source| %>
                <% if source["url"].present? %>
                  <%= link_to source["name"], source["url"], target: "_blank", rel: "noopener",
                      class: "text-tertiary text-[10px] hover:text-secondary underline decoration-border-subtle" %>
                <% else %>
                  <span class="text-muted text-[10px]"><%= source["name"] %></span>
                <% end %>
              <% end %>
            </div>
          <% end %>
        </div>
      </details>
    <% end %>
  </article>
<% end %>
